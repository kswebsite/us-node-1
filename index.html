<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    font-family: Arial, sans-serif;
    background: #eee;
  }

  /* Loading bar at the top */
  .loading-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: #222;
    overflow: hidden;
    border-radius: 0;
    z-index: 9999;
  }

  .loading-bar::before {
    content: "";
    position: absolute;
    left: -40%;
    width: 40%;
    height: 100%;
    background: limegreen;
    animation: slide 1.5s infinite;
  }

  @keyframes slide {
    0%   { left: -40%; }
    50%  { left: 60%; }
    100% { left: 100%; }
  }

  #ads-container {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    padding-top: 10px; /* leave space for loading bar */
  }

  #main-iframe {
    display: none;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>
</head>
<body>

<div class="loading-bar"></div>
<div id="ads-container"></div>

<iframe id="main-iframe" src="main.html"></iframe>

<script>
(function() {
  const ads = [
    { key:'6e909a89e65dd84c692ae2650e11190a', width:300, height:250 },
    { key:'2e5a54a0c86935584781e62d3f440a5f', width:728, height:90 },
    { key:'645610fd8eebceffa2b83ae78dc808f3', width:160, height:600 },
    { key:'16b560fff33c3af44643aa80ffc134fb', width:160, height:300 },
    { key:'31df62443731caf61d911aa7f5b7e1fa', width:468, height:60 },
    { key:'0516f7b4e9caf9cc408e9770382b3faa', width:320, height:50 }
  ];

  const TIME_KEY = 'adStartTime';
  const REPEAT_HOURS = 25;
  const now = Date.now();

  let startTime = parseInt(localStorage.getItem(TIME_KEY)) || 0;

  function showMain() {
    document.getElementById('ads-container').style.display = 'none';
    document.querySelector('.loading-bar').style.display = 'none';
    document.getElementById('main-iframe').style.display = 'block';
  }

  if (!startTime || now - startTime > REPEAT_HOURS * 3600 * 1000) {
    localStorage.setItem(TIME_KEY, now);

    const container = document.getElementById('ads-container');
    container.innerHTML = '';

    let adsLoaded = 0;

    ads.forEach(ad => {
      const iframe = document.createElement('iframe');
      iframe.width = ad.width;
      iframe.height = ad.height;
      iframe.style.border = '0';
      iframe.style.overflow = 'hidden';
      container.appendChild(iframe);

      const doc = iframe.contentWindow.document;
      doc.open();
      doc.write(`
        <script type="text/javascript">
        atOptions = { key:'${ad.key}', format:'iframe', width:${ad.width}, height:${ad.height}, params:{} };
        <\/script>
        <script type="text/javascript" src="//www.highperformanceformat.com/${ad.key}/invoke.js"><\/script>
      `);
      doc.close();

      iframe.onload = () => {
        adsLoaded++;
        if (adsLoaded === ads.length) {
          setTimeout(showMain, 7500); // wait 5s after all ads loaded
        }
      };
    });
  } else {
    // If ads were recently shown, just wait 5s
    setTimeout(showMain, 7500);
  }
})();
</script>

</body>
</html>
